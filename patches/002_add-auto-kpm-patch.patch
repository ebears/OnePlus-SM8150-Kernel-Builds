--- a/arch/arm64/boot/Makefile
+++ b/arch/arm64/boot/Makefile
@@ -47,6 +47,12 @@
   endif
 endif
 
+ifeq ($(CONFIG_KPM),y)
+	$(Q)cd $(obj) &&
+ $(Q)$(srctree)/scripts/patch_kpm
+	$(Q)mv -f $(obj)/oImage $@
+endif
+
 KBUILD_DEFCONFIG := defconfig
 
 # Check for binutils support for specific extensions